name: setup-mortar
description: "setup mortar"
inputs:
  config:
    description: "path of mortar config"
    required: false
    default: "./mortar.yaml"

runs:
  using: composite
  steps:
    - name: checkout
      uses: actions/checkout@v3
    - uses: chrisdickinson/setup-yq@latest
      with:
        yq-version: v4.9.8
    - name: Extract Mortar Version
      id: extract-mortar-version
      run: |-
        echo version=$(yq eval '.mortarVersion' ${{ inputs.config }}) >> $GITHUB_OUTPUT
      shell: bash
    - name: Pull Mortar build image
      shell: bash
      run: |
        docker pull hub.co-workerhou.se/platform/mortar-build:"${{ steps.extract-mortar-version.outputs.version }}"
    - name: Mount Mortar Remote
      shell: bash
      run: |
        docker run --interactive -e TERM=xterm-256color -e DEBUG=true \
        --mount type=bind,source=/var/run/docker.sock,target=/var/run/docker.sock --name mortar_cli \
        --user=root --rm --mount type=bind,source=${GITHUB_WORKSPACE}/${{ inputs.config }},target=${GITHUB_WORKSPACE}/app \
        hub.co-workerhou.se/platform/mortar-build:${{ steps.extract-mortar-version.outputs.version }} \
          
